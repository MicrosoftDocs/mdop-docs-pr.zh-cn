---
title: 创建 DaRT 8.0 恢复映像
description: 创建 DaRT 8.0 恢复映像
author: dansimp
ms.assetid: 39001b8e-86c0-45ef-8f34-2d6199f9922d
ms.reviewer: ''
manager: dansimp
ms.author: dansimp
ms.pagetype: mdop
ms.mktglfcycl: support
ms.sitesec: library
ms.prod: w10
ms.date: 08/21/2017
ms.openlocfilehash: 79ce5859e7d0eacf95124c2a7409ff6c21890d65
ms.sourcegitcommit: 354664bc527d93f80687cd2eba70d1eea024c7c3
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/26/2020
ms.locfileid: "10798074"
---
# 创建 DaRT 8.0 恢复映像


安装 Microsoft 诊断和恢复工具集（DaRT）8.0 后，创建一个 DaRT 8.0 恢复映像。 恢复映像将启动 Windows RE，您可以从中启动 DaRT 工具。 你可以生成国际标准化组织（ISO）文件和 Windows 映像格式（WIM）映像。 此外，你可以使用 PowerShell 生成使用在 DaRT 恢复映像向导中选择的设置的脚本。 你可以在以后使用该脚本，使用相同的设置重新生成恢复映像。 恢复映像提供各种恢复工具。 有关工具的说明，请参阅[DaRT 8.0 中的工具概述](overview-of-the-tools-in-dart-80-dart-8.md)。

将计算机启动到 DaRT 后，您可以运行不同的 DaRT 工具来尝试诊断和修复计算机。 本部分将引导你完成创建 DaRT 恢复映像的过程，并允许你选择要包含在映像中的工具和功能。

你可以使用以下两种方法之一创建 DaRT 恢复映像：

-   使用 DaRT 恢复映像向导，该向导在 Windows 环境中运行。

-   使用所需的值修改示例 PowerShell 脚本。 有关详细信息，请参阅[如何使用 PowerShell 脚本创建恢复映像](how-to-use-a-powershell-script-to-create-the-recovery-image-dart-8.md)。

你可以将 ISO 写入可写 CD 或 DVD，将其保存到 USB 闪存驱动器，或将其保存为可用于从远程分区或恢复分区启动到 DaRT 的格式。

创建 ISO 映像后，可以将其刻录到空白 CD 或 DVD （如果计算机具有 CD 或 DVD 驱动器）。 如果计算机没有用于此用途的驱动器，则可以使用用于刻录 Cd 或 Dvd 的大多数通用程序。

## 选择图像体系结构并指定路径


在 "Windows 8 媒体" 页面上，选择是创建32位还是64位 DaRT 恢复映像。 使用32位 Windows 构建32位 DaRT 恢复映像，并使用64位 Windows 构建64位 DaRT 恢复映像。 你可以使用一台计算机为两种体系结构类型创建恢复映像，但不能创建一个可在32位和64位体系结构上运行的映像。 你还可以指示 Windows 8 安装媒体的路径。 选择与你正在创建的恢复映像之一相匹配的体系结构。

**选择图像体系结构并指定路径**

1.  在 " **Windows 8 媒体**" 页面上，选择下列操作之一：

    -   如果要为64位计算机创建恢复映像，请选择 "**创建 x64 （64位） DaRT 映像**"。

    -   如果要为32位计算机创建恢复映像，请选择 "**创建 x86 （32位） DaRT 映像**"。

2.  在 "**指定 windows 8 &lt; 64 位或32位 &gt; 安装媒体的根路径**" 框中，键入 windows 8 安装文件的路径。 使用与正在创建的恢复映像的体系结构相匹配的路径。

3.  单击“下一步”****。

## 选择要包括在恢复映像中的工具


在 "工具" 页面上，您可以选择要包含在恢复映像上的多个工具。 这些工具将在最终用户启动到 DaRT 映像时可用。 但是，如果你在创建 DaRT 映像时启用远程连接，则无论你选择将哪些工具包括在映像中，所有工具都将在技术支持人员连接到最终用户的计算机时可用。

若要限制最终用户访问这些工具，但仍保留通过远程连接查看器对工具的完全访问权限，请不要在 "工具" 页面上选择这些工具。 最终用户将只能使用远程连接，并且能够看到从恢复映像中排除的任何工具，但不能访问。

**选择要包括在恢复映像中的工具**

1.  在 "**工具**" 页面上，选中要包括在图像上的每个工具旁边的复选框。

2.  单击“下一步”****。

## 选择是否允许帮助台远程连接


在 "远程连接" 页面上，您可以选择启用技术支持人员以在最终用户的计算机上远程连接和运行 DaRT 工具。 远程连接选项随后在 "诊断和恢复工具集" 窗口中显示为可用选项。 技术支持人员建立远程连接后，他们可以从远程位置从最终用户计算机上运行 DaRT 工具。

**选择是否允许帮助台工作人员进行远程连接**

1.  在 "**远程连接**" 页面上，选中 "**允许远程连接**" 复选框以允许远程连接，或清除复选框以防止远程连接。

2.  如果已清除 "**允许远程连接**" 复选框，请单击 "**下一步**"。 否则，请转到下一步，继续配置远程连接。

3.  选择以下其中一项：

    -   让 Windows 选择打开的端口号。

    -   指定端口号。 如果选择此选项，请在选项下方的字段中输入一个介于1和65535之间的端口号。 将在建立远程连接时使用此端口号。 建议端口号为1024或更高，以将冲突可能性降至最低。

4.  （可选）在 "**远程连接欢迎**消息" 框中，创建最终用户建立远程连接时接收的自定义消息。 该消息最多可以为2048个字符。

5.  单击“下一步”****。

    有关远程运行 DaRT 工具的详细信息，请参阅[如何使用 DaRT 恢复映像恢复远程计算机](how-to-recover-remote-computers-by-using-the-dart-recovery-image-dart-8.md)。

## 将驱动程序添加到恢复映像


在 "高级选项" 页面的 "驱动程序" 选项卡上，你可以添加修复计算机时可能需要的其他设备驱动程序。 这些通常可能包括 Windows 8 不提供的存储或网络控制器。 驱动程序是在创建映像时安装的。

**重要提示** 选择要包括的驱动程序时，请注意，DaRT 中不支持无线连接（如蓝牙或 802.11 a/b/n）。

 

**将驱动程序添加到恢复映像**

1.  在 "**高级选项**" 页面上，单击 "**驱动程序**" 选项卡。

2.  单击**添加**。

3.  通过浏览找到要为驱动程序添加的文件，然后单击 "**打开**"。

    **注意** 驱动程序文件由存储或网络控制器的制造商提供。

     

4.  对要包括的每个驱动程序重复步骤2和3。

5.  单击“下一步”****。

## 将 WinPE 可选程序包添加到恢复映像


在 "高级选项" 页面的 "WinPE" 选项卡上，你可以将 WinPE 可选程序包添加到 DaRT 映像。 这些程序包是 Windows ADK 的一部分，它是 DaRT 恢复映像向导的安装先决条件。 可以选择的工具全都是可选的。 将根据你在 "工具" 页面上选择的工具自动添加任何所需的程序包。

你还可以指定暂存空间的大小。 "暂存空间" 表示为使 DaRT 运行而留出的 RAM 磁盘空间量。 如果最终用户的硬盘不可用，则暂存空间非常有用。 如果你正在运行其他工具和驱动程序，你可能需要增加暂存空间。

**将 WinPE 可选程序包添加到恢复映像**

1.  在 "**高级选项**" 页面上，单击 " **WinPE** " 选项卡。

2.  选中要包括在图像上的每个程序包旁边的复选框，或单击 "**名称**" 复选框以选择所有程序包。

3.  在 "**暂存空间**" 字段中，选择要分配用于运行 DART 的 RAM 磁盘空间量（如果最终用户的硬盘不可用）。

4.  单击“下一步”****。

## 为崩溃分析程序添加调试工具


如果在 ISO 映像中包含崩溃分析器工具，则还必须包括 Windows 调试工具。 在 "高级选项" 页面的 "崩溃分析程序" 选项卡上，输入 Windows 8 调试工具的路径，崩溃分析程序使用这些工具分析内存转储文件。 你可以使用运行 DaRT 恢复映像向导的计算机上的工具，也可以使用最终用户计算机上的工具。 如果你决定使用最终用户计算机上的工具，请记住你诊断的每台计算机必须安装调试工具。

如果安装了 Microsoft Windows 软件开发工具包（SDK）或 Microsoft Windows 开发工具包（WDK），则默认情况下会将 Windows 8 调试工具添加到恢复映像，并自动填充调试工具的路径。 如果文件位于默认文件路径所指示的位置以外的位置，则可以更改 Windows 8 调试工具的路径。 通过向导中的链接，你可以下载并安装 Windows 调试工具（如果尚未安装）。

若要下载 Windows 调试工具，请参阅[Windows 调试工具](https://go.microsoft.com/fwlink/?LinkId=266248)。 将调试工具安装到默认位置。

**注意** DaRT 向导将检查注册表项中的工具 `HKLM\Software\Microsoft\Windows Kits\Installed Roots\WindowsDebuggersRoot` 。 如果注册表值不在该位置，向导将根据您的系统体系结构查找下列位置之一：

`%ProgramFilesX86%\Windows Kits\8.0\Debuggers\x64`

`%ProgramFilesX86%\Windows Kits\8.0\Debuggers\x86`

 

**为崩溃分析程序添加调试工具**

1.  在 "**高级选项**" 页面上，单击 "**崩溃分析器**" 选项卡。

2.  可选单击 "**下载调试工具**" 以下载 Windows 调试工具。

3.  选择下列选项之一：

    -   **包括 Windows 8 &lt; 64 位或32位 &gt; 调试工具**。 如果选择此选项，请通过浏览找到并选择工具的位置（如果路径尚未显示）。

    -   **使用正在调试的系统中的调试工具**。 如果选择此选项，在问题计算机上找不到 Windows 调试工具时，崩溃分析器将无法正常工作。

4.  单击“下一步”****。

## 添加 Defender 工具的定义


在 "高级选项" 页面的 "Defender" 选项卡上，添加定义，由 Defender 工具用于确定尝试在计算机上安装、运行或更改设置的软件是不需要还是恶意软件。

**为 Defender 工具添加定义**

1.  在 "**高级选项**" 页面上，单击 " **Defender** " 选项卡。

2.  选择下列选项之一：

    -   **下载最新的定义（推荐）** -定义更新会自动启动，并且定义将添加到 DaRT 恢复映像。 建议使用此选项，以帮助避免这些定义可能不可用的情况。 必须连接到 Internet 才能下载定义。

    -   **稍后下载定义**-不会将定义包括在 dart 恢复映像中，你将需要从运行 dart 的计算机下载定义。

        如果你决定不在恢复映像上包含最新的定义，或者在你准备好使用 Defender 时恢复映像中包含的定义不再是最新的，请按照 Defender 中提供的说明在开始扫描之前获取最新的定义。

        **重要提示** 如果没有定义，则无法扫描。

         

3.  单击“下一步”****。

## 选择要创建的恢复图像文件的类型


在 "创建图像" 页面上，为恢复映像选择输出文件夹，输入一个图像名称，然后选择要创建的 DaRT 恢复图像文件的类型。 在恢复映像创建过程中，将解压缩 Windows 源文件，并将 DaRT 文件复制到该文件，然后将该映像 "重新打包" 为您在此页面上选择的文件格式。

可用的图像文件类型包括：

-   **Windows 映像文件（WIM）** -用于将 DaRT 部署到预启动执行环境（PXE）或本地分区。

-   **ISO 映像文件**-用于部署到 CD 或 DVD，或用于在虚拟机（VM）中使用的文件。 该向导要求 ISO 映像具有 .iso 文件扩展名，因为刻录 CD 或 DVD 的大多数程序都需要该扩展。 如果不指定其他位置，将在桌面上创建使用名称 DaRT8 的 ISO 图像。

-   **PowerShell 脚本**–创建一个 DaRT 恢复映像，其命令实际上提供的选项与你可以使用 DaRT 恢复映像向导选择的选项基本相同。 该脚本还允许你在 DaRT 恢复映像中添加或更改文件。

如果您在此页面上选择 "编辑图像" 复选框，则可以在创建图像过程中自定义恢复图像。 例如，你可以更改 "winpeshl.ini" 文件以创建自定义启动顺序或添加第三方工具。

**选择要创建的恢复图像文件的类型**

1.  在 "**创建图像**" 页面上，单击 "**浏览**" 以选择图像文件的输出文件夹。

    **注意** 图像的大小会有所不同，具体取决于你选择的工具和你在向导中添加的文件。

     

2.  在 "**映像名称**" 框中，输入 DaRT 恢复映像的名称，或接受默认名称 DaRT8。

    向导将在输出路径中使用此名称创建一个子文件夹。

3.  选择要创建的图像文件的类型。

4.  选择下列操作之一：

    -   若要在创建图像文件之前更改恢复映像中的文件，请选中 "**编辑图像**" 复选框，然后单击 "**准备**"。

    -   若要在不更改文件的情况下创建恢复映像，请单击 "**创建**"。

5.  

    单击“下一步”****。

## 编辑恢复图像文件


只有选中 "创建图像" 页面上的 "编辑图像" 复选框，才能编辑恢复图像。 在恢复映像准备好进行编辑之后，你可以在创建可启动媒体之前添加和修改恢复镜像文件。 例如，你可以创建启动的自定义顺序、添加各种第三方工具等。

**编辑恢复图像文件**

1.  在 "**编辑图像**" 页面上，单击 "在 Windows 资源管理器中**打开**"。

2.  在对话框中列出的文件夹中创建一个子文件夹。

3.  将所需的文件复制到新子文件夹，或删除不需要的文件。

4.  单击 "**创建**" 开始创建恢复映像。

## 生成恢复图像文件


在 "生成文件" 页面上，将为你在 "创建映像" 页面上选择的文件类型生成 DaRT 恢复映像。

**生成恢复图像文件**

-   在 "**生成文件**" 页面上，单击 "**下一步**" 以生成恢复图像文件。

## 将恢复映像复制到 CD、DVD 或 USB


在 "创建可启动媒体" 页面上，你可以选择将图像文件复制到 CD、DVD 或 USB 闪存驱动器（UFD）。 您也可以通过重新启动向导，从该页面创建其他可启动媒体。

**注意** 此工具本身不支持预启动执行环境（PXE）和本地映像部署，因为它们需要其他企业工具，如 System Center Configuration Manager 服务器和 Microsoft 开发工具包。

 

**将恢复映像复制到 CD、DVD 或 USB**

1.  在 "**创建可启动媒体**" 页面上，选择要复制的 iso 文件。

2.  插入 CD、DVD 或 USB，然后选择驱动器。

    **注意** 如果无法识别驱动器且安装了新驱动器，则可以单击 "**刷新**" 以强制向导更新可用的驱动器列表。

     

3.  单击 "**创建可启动介质**" 按钮。

4.  若要创建另一个恢复映像，请单击 "重新启动"，如果已完成创建所需的所有媒体，请单击 "**关闭**"。

## 相关主题


[DaRT 8.0 中的工具概述](overview-of-the-tools-in-dart-80-dart-8.md)

[部署 DaRT 8.0](deploying-dart-80-dart-8.md)

 

 





